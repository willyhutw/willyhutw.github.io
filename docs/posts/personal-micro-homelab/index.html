<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:1.1rem}</style><title>æˆ‘çš„Micro HomeLab</title><meta name=description content="Project Link:
https://github.com/willyhutw/microlab-bootstrap https://github.com/willyhutw/microlab èµ·æº 2023å¹´å› ç·£éš›æœƒï¼Œæ™‚å¸¸è·Ÿä¸€ä½æˆ‘å¾ˆå°Šæ•¬çš„å‰è¼©æ··åœ¨ä¸€èµ· :P é‚£æ™‚å€™ä¸‰ä¸äº”æ™‚å°±æœƒè½ä»–æåˆ°pfSenseé€™å¥—è»Ÿé«”é˜²ç«ç‰† â€¦"><meta name=keywords content='homelab,pfsense,k8s,helm,argocd,snmp,fluentbit,prometheus,loki,grafana'><meta property="og:url" content="https://willyhu.tw/posts/personal-micro-homelab/"><meta property="og:type" content="website"><meta property="og:title" content="æˆ‘çš„Micro HomeLab"><meta property="og:description" content="Project Link:
https://github.com/willyhutw/microlab-bootstrap https://github.com/willyhutw/microlab èµ·æº 2023å¹´å› ç·£éš›æœƒï¼Œæ™‚å¸¸è·Ÿä¸€ä½æˆ‘å¾ˆå°Šæ•¬çš„å‰è¼©æ··åœ¨ä¸€èµ· :P é‚£æ™‚å€™ä¸‰ä¸äº”æ™‚å°±æœƒè½ä»–æåˆ°pfSenseé€™å¥—è»Ÿé«”é˜²ç«ç‰† â€¦"><meta property="og:image" content="https://willyhu.tw/"><meta property="og:image:secure_url" content="https://willyhu.tw/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="æˆ‘çš„Micro HomeLab"><meta name=twitter:description content="Project Link:
https://github.com/willyhutw/microlab-bootstrap https://github.com/willyhutw/microlab èµ·æº 2023å¹´å› ç·£éš›æœƒï¼Œæ™‚å¸¸è·Ÿä¸€ä½æˆ‘å¾ˆå°Šæ•¬çš„å‰è¼©æ··åœ¨ä¸€èµ· :P é‚£æ™‚å€™ä¸‰ä¸äº”æ™‚å°±æœƒè½ä»–æåˆ°pfSenseé€™å¥—è»Ÿé«”é˜²ç«ç‰† â€¦"><meta property="twitter:domain" content="https://willyhu.tw/posts/personal-micro-homelab/"><meta property="twitter:url" content="https://willyhu.tw/posts/personal-micro-homelab/"><meta name=twitter:image content="https://willyhu.tw/"><link rel=canonical href=https://willyhu.tw/posts/personal-micro-homelab/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.7136b4abac7b277aba8bc933917f4602d39a5c44f5590be687244bc86ef4f162.js integrity="sha256-cTa0q6x7J3q6i8kzkX9GAtOaXET1WQvmhyRLyG708WI="></script><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ–ï¸</text></svg>"></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=https://willyhu.tw/>Hello World</a></div><div class=nav-links><div class=nav-link><a href=https://willyhu.tw/posts/ aria-label=posts>Posts</a></div><div class=nav-link><a href=https://willyhu.tw/tags/ aria-label=tags>Tags</a></div><div class=nav-link><a href=https://github.com/willyhutw aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://www.linkedin.com/in/yu-lin-hu aria-label=linkedin><span data-feather=linkedin></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://willyhu.tw/posts/>Posts</a></li><li class=nav-item><a href=https://willyhu.tw/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/willyhutw><span data-feather=github></span></a></li><li class=nav-item><a href=https://www.linkedin.com/in/yu-lin-hu><span data-feather=linkedin></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>æˆ‘çš„Micro HomeLab</h1><small role=doc-subtitle></small><p class=post-date>August 27, 2025</p><ul class=post-tags><li class=post-tag><a href=https://willyhu.tw/tags/homelab>homelab</a></li><li class=post-tag><a href=https://willyhu.tw/tags/pfsense>pfsense</a></li><li class=post-tag><a href=https://willyhu.tw/tags/k8s>k8s</a></li><li class=post-tag><a href=https://willyhu.tw/tags/helm>helm</a></li><li class=post-tag><a href=https://willyhu.tw/tags/argocd>argocd</a></li><li class=post-tag><a href=https://willyhu.tw/tags/snmp>snmp</a></li><li class=post-tag><a href=https://willyhu.tw/tags/fluentbit>fluentbit</a></li><li class=post-tag><a href=https://willyhu.tw/tags/prometheus>prometheus</a></li><li class=post-tag><a href=https://willyhu.tw/tags/loki>loki</a></li><li class=post-tag><a href=https://willyhu.tw/tags/grafana>grafana</a></li></ul></div><div class=post-content><p><strong>Project Link</strong>:</p><ul><li><a href=https://github.com/willyhutw/microlab-bootstrap>https://github.com/willyhutw/microlab-bootstrap</a></li><li><a href=https://github.com/willyhutw/microlab>https://github.com/willyhutw/microlab</a></li></ul><h3 id=èµ·æº>èµ·æº</h3><p>2023å¹´å› ç·£éš›æœƒï¼Œæ™‚å¸¸è·Ÿä¸€ä½æˆ‘å¾ˆå°Šæ•¬çš„å‰è¼©æ··åœ¨ä¸€èµ· :P é‚£æ™‚å€™ä¸‰ä¸äº”æ™‚å°±æœƒè½ä»–æåˆ°<strong>pfSense</strong>é€™å¥—è»Ÿé«”é˜²ç«ç‰†å’Œä»–å®¶ã€Œ<strong>æ©Ÿæˆ¿</strong>ã€çš„å„ç¨®å¤§å°äº‹ï¼Œéå¸¸é…·ï¼æˆ‘ä¹Ÿæƒ³ç©ç©çœ‹ï¼å…¶å¯¦æˆ‘ä¸€ç›´ä»¥ä¾†éƒ½å¾ˆæƒ³è¦æœ‰å€‹Labï¼Œå¯é•·æœŸç”¨ä¾†æ¸¬è©¦æˆ–è·‘äº›æœ‰çš„æ²’çš„ï¼Œé›–ç„¶é€éIaCå†åŠ ä¸Šä¸€ç³»åˆ—çš„è‡ªå‹•åŒ–ä¹Ÿèƒ½è¼•é¬†ä¸€éµåœ¨é›²ç«¯ä½ˆç½²æƒ³è¦çš„å¯¦é©—ç’°å¢ƒï¼Œä½†æˆ‘å°±æ˜¯å¾ˆæ€•æœƒå¿˜äº†åˆªæ‰ã€‚</p><p>ä¸€é–‹å§‹æƒ³çœéŒ¢ï¼Œåªé ä¸€å°å°PCæ’æ»¿USBç¶²å¡è·‘VMï¼Œå…¶å¯¦é€™æ¨£çª®é…¸çš„ä½œæ³•çµ•å°å¯è¡Œï¼Œå‰ææ˜¯é‚£å°æ©Ÿå™¨è¦å¤ ç©©ã€‚æœ‰æ®µæ™‚é–“æˆ‘æ¯éš”ä¸€åˆ°å…©å¤©å°±æœƒé‡åˆ°kernelå™´ç¶²å¡ç›¸é—œçš„éŒ¯èª¤ï¼Œç„¶å¾Œå°±æ˜¯å…¨å®¶æ²’ç¶²è·¯å¯ç”¨ã€é›»è¦–ä¸èƒ½çœ‹ã€æƒåœ°æ©Ÿå™¨äººå«ä¸å‹•ï¼Œå¹¾æ¬¡ä¸‹ä¾†æˆ‘çœŸçš„ä¸æ•¢äº†â€¦</p><p>å¾Œä¾†æˆ‘æŠŠpfSenseå®‰è£åœ¨å°ˆé–€ç”¨ä¾†ç•¶ä½œè·¯ç”±å™¨çš„ç‰¹è£½å°PC(<a href=https://www.amazon.com/dp/B07G9NHRGQ>Protectli Vault FW4B</a>)ï¼Œåˆ°ç›®å‰ç‚ºæ­¢è·‘äº†å…©å¹´å¤šï¼ŒpfSenseä¹Ÿå‡äº†å¥½å¹¾å€‹ç‰ˆæœ¬ï¼Œå®Œå…¨æ²’å‡ºéäº‹ã€‚åŸæœ¬çš„å°PC(Intel NUC)è®Šæˆä¸»è¦Labç¹¼çºŒç”¨KVM Libvirtè·‘K8Sã€‚</p><p>äººæ²’äº‹å°±æ˜¯æœƒæ‰¾äº‹åšã€‚ä¸æ›‰å¾—ç‚ºä»€éº¼ï¼Œæœ‰æ®µæ™‚é–“æˆ‘å°±å¾ˆæƒ³æŠŠæ¨¹è“æ´¾ç–Šåœ¨ä¸€èµ·è·‘K8Sã€‚ç„¶å¾Œå°±è²·äº†ä¸€å°æ¨¹è“æ´¾5(8G)ï¼Œæœ‰äº†ä¸€å°è¦ºå¾—è©²è²·ç¬¬äºŒå°ï¼Œæœ‰äº†å…©å°åˆè¦ºå¾—è‡³å°‘è¦å››å°ï¼Œæœ‰äº†å››å°åˆè¦ºå¾—å…¶å¯¦å…­å°æ‰æ˜¯æœ€å®Œç¾çš„â€¦æœ€å¾Œç†æ™ºå‹å‡ºï¼Œæˆ‘åªæœ‰å››å°ã€‚å†ä¾†å°±æ˜¯è¦åŠƒæ–°çš„Labï¼Œä¹Ÿéœ€è¦æŠŠåŸæœ¬è·‘åœ¨amd64æ¶æ§‹ä¸Šçš„å®¹å™¨é·ç§»åˆ°arm64æ¶æ§‹ï¼Œè½èµ·ä¾†æ„Ÿè¦ºæ²’ä»€éº¼ï¼Œä½†å…¶å¯¦éç¨‹ä¸­é‡åˆ°ä¸å°‘å‘ï¼Œä¹‹å¾Œçœ‹æœ‰æ²’æœ‰æ©Ÿæœƒå†èŠé€™éƒ¨ä»½ï¼</p><p>æˆ‘çŸ¥é“ç›®å‰Labé‚„æœ‰å¾ˆå¤šåœ°æ–¹å¯ä»¥å†èª¿æ•´åˆ°æ›´å¥½ï¼Œä½†æˆ‘ç¾åœ¨çœŸçš„åªæœ‰åœ¨é–’æš‡ä¹‹é¤˜æˆ–å¿ƒè¡€ä¾†æ½®æ™‚æ‰æœ‰å‹•åŠ›â€¦å¶çˆ¾ä¹Ÿæœƒæœ‰å¿µé ­æƒ³æŠŠå®ƒå€‘é€šé€šéƒ½é—œæ‰ï¼Œè¦ºå¾—å¥½åƒæ²’ä»€éº¼åƒ¹å€¼å¤šæµªè²»é›»è€Œå·²(æ¯æœˆ20~25kWh)ã€‚é‚£æˆ‘å°±è¶é‚„æ²’é—œæ‰å‰åˆ†äº«ä¸€ä¸‹ç›®å‰Labçš„æ¶æ§‹ï¼Œä¹Ÿç®—æ˜¯æ›¿è‡ªå·±ç´€éŒ„ï¼Œå¸Œæœ›æœªä¾†èƒ½æœ‰å‹•åŠ›åˆ†äº«æ›´å¤šã€‚</p><p><img src=/images/protectli_vault_fw4b.jpg alt="FProtectli Vault FW4B"></p><p><img src=/images/pi_cluster.jpg alt="Raspberry Pi Cluster"></p><p><img src=/images/homelab.jpg alt="The homelab in living room."></p><h3 id=å°å¤–æœå‹™>å°å¤–æœå‹™</h3><pre class=mermaid>
  ---
config:
  theme: &#39;base&#39;
  themeVariables:
    fontSize: 20px
---
flowchart TD
  INTERNET[ğŸŒ Internet] ==&gt; HINET_ROUTER[&#34;ğŸ“ HiNet Router (Bridge Mode)&#34;]
  HINET_ROUTER ==&gt; PF_ROUTER[ğŸ§± pfSense Firewall]

  PF_ROUTER --- LAN[ğŸ  LAN 192.168.X.0/24]
  PF_ROUTER == NAT ==&gt; LAB1[ğŸ§ª LAB 1 192.168.Y.0/24]
  PF_ROUTER --- LAB2[ğŸ§ª LAB 2 192.168.Z.0/24]

  LAN --- WIFI[ğŸ›œ WIFI]
  LAN --- TV[ğŸ“º TV]
  LAN --- PC[ğŸ–¥ï¸ PC]

  LAB1 --- PI_CP[ğŸ“ Raspberry Pi&lt;br/&gt; Control Plane]
  LAB1 ==&gt; PI_NO[ğŸ“ Raspberry Pi&lt;br/&gt; Nodes]

  LAB2 --- PLAYGROUND[ğŸ–¥ï¸ Mini PC&lt;br/&gt; KVM - Libvirt&lt;/br&gt; Playground]

  subgraph &#34;â˜¸ï¸ K8S&#34;
    PI_CP
    PI_NO ==&gt; EIGW[&#34;ğŸšª External Ingress Gateway&#34;]
    EIGW ==&gt; Willyhutw[&#34;ğŸ”’ Personal Blog&lt;/br&gt;(https://willyhu.tw)&#34;]
  end
</pre><p><strong>Hightlights</strong>:</p><ul><li>é˜²ç«ç‰†å°å¤–åªé–‹ TCP: 80, 443.</li><li>é˜²ç«ç‰† (Public IP) èˆ‡ exteral-ingress-gateway (Private IP) NAT.</li><li>PersonalBlog&rsquo;s Gateway æŒ‡å‘(label selector) exteral-ingress-gateway.</li><li>Cert-manager + Let&rsquo;s encrypt certificate + https redirect to PersonalBlog&rsquo;s Gateway.</li><li>Cloudflare DNSè¨—ç®¡ + CDN, é¿å…å°å¤–IPæš´éœ².</li></ul><hr><h3 id=å…§éƒ¨æœå‹™>å…§éƒ¨æœå‹™</h3><pre class=mermaid>
  ---
config:
  theme: &#39;base&#39;
  themeVariables:
    fontSize: 20px
---
flowchart TD
  PF_ROUTER[ğŸ§± pfSense Firewall]

  PC[ğŸ–¥ï¸ PC - Willy Hu] ==&gt; LAN
  LAN[ğŸ  LAN 192.168.X.0/24] ==&gt; PF_ROUTER
  PF_ROUTER ==&gt; LAB1[ğŸ§ª LAB 1 192.168.Y.0/24]

  LAB1 --- PI_CP[ğŸ“ Raspberry Pi&lt;br/&gt; Control Plane]
  LAB1 ==&gt; PI_NO[ğŸ“ Raspberry Pi&lt;br/&gt; Nodes]

  subgraph &#34;â˜¸ï¸ K8S&#34;
    PI_CP

    PI_NO ==&gt; IIGW[ğŸšª Internal Ingress Gateway]

    IIGW ==&gt; Argocd[ğŸ”’ ArgoCD&lt;/br&gt;argocd.willyhu.tw]
    IIGW ==&gt; Grafana[ğŸ”’ Grafana&lt;/br&gt;grafana.willyhu.tw]
    IIGW ==&gt; Prometheus[ğŸ”’ Prometheus&lt;/br&gt;prometheus.willyhu.tw]
    IIGW ==&gt; Loki[ğŸ”’ Loki&lt;/br&gt;loki.willyhu.tw]
    IIGW ==&gt; Kiali[ğŸ”’ Kiali&lt;/br&gt;kiali.willyhu.tw]
  end
</pre><p><strong>Hightlights</strong>:</p><ul><li>é˜²ç«ç‰†è¦å‰‡:<ul><li>LANèˆ‡æ‰€æœ‰LABsçš†éš”é›¢ä¸èƒ½äº’ç›¸è¨ªå•.</li><li>é™¤äº†æˆ‘ä¹‹å¤– (DHCP Static Mappings).</li></ul></li><li>InternalServices Gateway æŒ‡å‘(label selector) internal-ingress-gateway.</li><li>Cert-manager + Let&rsquo;s encrypt certificate + https redirect to InternalServices Gateway.</li><li>Proper Gateway/VirtualService allowing host for InternalServices.</li><li>é˜²ç«ç‰†å…§éƒ¨DNS(resolver) host override.<ul><li>argocd.willyhu.tw => internal-ingress-gateway&rsquo;s privete ip (192.168.12.X)</li><li>grafana.willyhu.tw => internal-ingress-gateway&rsquo;s privete ip (192.168.12.X)</li><li>&mldr;</li></ul></li></ul><hr><h3 id=data-etl-pipeline>Data ETL Pipeline</h3><pre class=mermaid>
  ---
config:
  theme: &#39;base&#39;
  themeVariables:
    fontSize: 20px
---
flowchart
  PF_ROUTER[ğŸ§± pfSense Firewall]

  PF_ROUTER ==&gt; DataEntry

  SnmpExporter ==&gt; PF_ROUTER
  Prometheus ==&gt; SnmpExporter

  %% K8S Cluster  
  subgraph &#34;â˜¸ï¸ K8S&#34;
    SnmpExporter[SNMP Exporter]
    Prometheus[Prometheus]

    DataEntry[FLB Input - &lt;/br&gt; UDP Server]
    DataFilterPfsense[FLB Filter - &lt;/br&gt; pfsense_log_parser]

    DataTail[&#34;FLB Input - &lt;/br&gt; Tail (DaemonSet)&#34;]
    DataFilterWillyhutw[FLB Filter - &lt;/br&gt; willyhutw_log_parser]

    DataOutputLoki[FLB Output - &lt;/br&gt; Loki]

    Loki[Loki]

    DataEntry ==&gt; DataFilterPfsense
    DataFilterPfsense ==&gt; DataOutputLoki

    DataTail ==&gt; DataFilterWillyhutw
    DataFilterWillyhutw ==&gt; DataOutputLoki

    DataOutputLoki ==&gt; Loki
  end
</pre><p><strong>Hightlights</strong>:</p><ul><li>é˜²ç«ç‰†Metric:<ul><li>é–‹å•ŸSNMPæœå‹™ä¸¦ä¸”åªå…è¨±LAB networkå­˜å–.</li><li>SNMP Exporter fetch metrics from firewall.</li><li>Prometheus scrape from SNMP Exporter.</li><li>åƒè€ƒ: <a href=https://www.willyhu.tw/posts/snmp-exporter-for-pfsense/>https://www.willyhu.tw/posts/snmp-exporter-for-pfsense/</a></li></ul></li><li>é˜²ç«ç‰†Log: FluentBit<ul><li>åƒè€ƒ: <a href=https://www.willyhu.tw/posts/pfsense-filterlog-collection/>https://www.willyhu.tw/posts/pfsense-filterlog-collection/</a></li></ul></li><li>PersonalBlog&rsquo;s Log: FluentBit
<img src=/images/willyhutw-access-log.png alt="willyhutw access dashboard."></li></ul></div><div class=prev-next></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer><script type=module>
            import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
            mermaid.initialize({ startOnLoad: true });
        </script></body></html>