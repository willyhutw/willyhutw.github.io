<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:1.1rem}</style><title>SNMP Exporter for pfSense</title><meta name=description content=" p f S e n s e s n m p s n m p _ e P x r p s o o c m r r e t a t e p h r e e u s d a t a s o u r c e G r a f a n a Introdution This post will be focused on how ‚Ä¶"><meta name=keywords content='pfsense,snmp,snmp_exporter,prometheus,grafana'><meta property="og:url" content="https://www.willyhu.tw/posts/snmp-exporter-for-pfsense/"><meta property="og:type" content="website"><meta property="og:title" content="SNMP Exporter for pfSense"><meta property="og:description" content=" p f S e n s e s n m p s n m p _ e P x r p s o o c m r r e t a t e p h r e e u s d a t a s o u r c e G r a f a n a Introdution This post will be focused on how ‚Ä¶"><meta property="og:image" content="https://www.willyhu.tw/"><meta property="og:image:secure_url" content="https://www.willyhu.tw/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="SNMP Exporter for pfSense"><meta name=twitter:description content=" p f S e n s e s n m p s n m p _ e P x r p s o o c m r r e t a t e p h r e e u s d a t a s o u r c e G r a f a n a Introdution This post will be focused on how ‚Ä¶"><meta property="twitter:domain" content="https://www.willyhu.tw/posts/snmp-exporter-for-pfsense/"><meta property="twitter:url" content="https://www.willyhu.tw/posts/snmp-exporter-for-pfsense/"><meta name=twitter:image content="https://www.willyhu.tw/"><link rel=canonical href=https://www.willyhu.tw/posts/snmp-exporter-for-pfsense/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.7136b4abac7b277aba8bc933917f4602d39a5c44f5590be687244bc86ef4f162.js integrity="sha256-cTa0q6x7J3q6i8kzkX9GAtOaXET1WQvmhyRLyG708WI="></script><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèñÔ∏è</text></svg>"></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=nav-title><a class=nav-brand href=https://www.willyhu.tw/>Hello World</a></div><div class=nav-links><div class=nav-link><a href=https://www.willyhu.tw/posts/ aria-label=posts>Posts</a></div><div class=nav-link><a href=https://www.willyhu.tw/tags/ aria-label=tags>Tags</a></div><div class=nav-link><a href=https://github.com/willyhutw aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://www.linkedin.com/in/yu-lin-hu aria-label=linkedin><span data-feather=linkedin></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://www.willyhu.tw/posts/>Posts</a></li><li class=nav-item><a href=https://www.willyhu.tw/tags/>Tags</a></li><li class=nav-item><a href=https://github.com/willyhutw><span data-feather=github></span></a></li><li class=nav-item><a href=https://www.linkedin.com/in/yu-lin-hu><span data-feather=linkedin></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>SNMP Exporter for pfSense</h1><small role=doc-subtitle></small><p class=post-date>April 23, 2024</p><ul class=post-tags><li class=post-tag><a href=https://www.willyhu.tw/tags/pfsense>pfsense</a></li><li class=post-tag><a href=https://www.willyhu.tw/tags/snmp>snmp</a></li><li class=post-tag><a href=https://www.willyhu.tw/tags/snmp_exporter>snmp_exporter</a></li><li class=post-tag><a href=https://www.willyhu.tw/tags/prometheus>prometheus</a></li><li class=post-tag><a href=https://www.willyhu.tw/tags/grafana>grafana</a></li></ul></div><div class=post-content><div class="goat svg-container"><svg font-family="Menlo,Lucida Console,monospace" viewBox="0 0 576 153"><g transform="translate(8,16)"><path d="M24 0h80" fill="none" stroke="currentColor"/><path d="M2e2.0H328" fill="none" stroke="currentColor"/><path d="M112 16h88" fill="none" stroke="currentColor"/><path d="M24 32h80" fill="none" stroke="currentColor"/><path d="M2e2 32H328" fill="none" stroke="currentColor"/><path d="M240 96h16" fill="none" stroke="currentColor"/><path d="M256 96h88" fill="none" stroke="currentColor"/><path d="M480 96h80" fill="none" stroke="currentColor"/><path d="M352 112H480" fill="none" stroke="currentColor"/><path d="M240 128H344" fill="none" stroke="currentColor"/><path d="M480 128h80" fill="none" stroke="currentColor"/><path d="M24 0V32" fill="none" stroke="currentColor"/><path d="M104 0V32" fill="none" stroke="currentColor"/><path d="M2e2.0V16" fill="none" stroke="currentColor"/><path d="M2e2 16V32" fill="none" stroke="currentColor"/><path d="M240 96v32" fill="none" stroke="currentColor"/><path d="M256 48V96" fill="none" stroke="currentColor"/><path d="M328 0V32" fill="none" stroke="currentColor"/><path d="M344 96v32" fill="none" stroke="currentColor"/><path d="M480 96v16" fill="none" stroke="currentColor"/><path d="M480 112v16" fill="none" stroke="currentColor"/><path d="M560 96v32" fill="none" stroke="currentColor"/><polygon points="120.000000,16.000000 108.000000,10.400000 108.000000,21.600000" fill="currentColor" transform="rotate(180.000000, 112.000000, 16.000000)"/><path d="M256 40v8" fill="none" stroke="currentColor"/><polygon points="272.000000,48.000000 260.000000,42.400002 260.000000,53.599998" fill="currentColor" transform="rotate(270.000000, 256.000000, 48.000000)"/><polygon points="360.000000,112.000000 348.000000,106.400002 348.000000,117.599998" fill="currentColor" transform="rotate(180.000000, 352.000000, 112.000000)"/><text text-anchor="middle" x="40" y="20" fill="currentColor" style="font-size:1em">p</text><text text-anchor="middle" x="48" y="20" fill="currentColor" style="font-size:1em">f</text><text text-anchor="middle" x="56" y="20" fill="currentColor" style="font-size:1em">S</text><text text-anchor="middle" x="64" y="20" fill="currentColor" style="font-size:1em">e</text><text text-anchor="middle" x="72" y="20" fill="currentColor" style="font-size:1em">n</text><text text-anchor="middle" x="80" y="20" fill="currentColor" style="font-size:1em">s</text><text text-anchor="middle" x="88" y="20" fill="currentColor" style="font-size:1em">e</text><text text-anchor="middle" x="144" y="4" fill="currentColor" style="font-size:1em">s</text><text text-anchor="middle" x="152" y="4" fill="currentColor" style="font-size:1em">n</text><text text-anchor="middle" x="160" y="4" fill="currentColor" style="font-size:1em">m</text><text text-anchor="middle" x="168" y="4" fill="currentColor" style="font-size:1em">p</text><text text-anchor="middle" x="216" y="20" fill="currentColor" style="font-size:1em">s</text><text text-anchor="middle" x="224" y="20" fill="currentColor" style="font-size:1em">n</text><text text-anchor="middle" x="232" y="20" fill="currentColor" style="font-size:1em">m</text><text text-anchor="middle" x="240" y="20" fill="currentColor" style="font-size:1em">p</text><text text-anchor="middle" x="248" y="20" fill="currentColor" style="font-size:1em">_</text><text text-anchor="middle" x="256" y="20" fill="currentColor" style="font-size:1em">e</text><text text-anchor="middle" x="256" y="116" fill="currentColor" style="font-size:1em">P</text><text text-anchor="middle" x="264" y="20" fill="currentColor" style="font-size:1em">x</text><text text-anchor="middle" x="264" y="116" fill="currentColor" style="font-size:1em">r</text><text text-anchor="middle" x="272" y="20" fill="currentColor" style="font-size:1em">p</text><text text-anchor="middle" x="272" y="68" fill="currentColor" style="font-size:1em">s</text><text text-anchor="middle" x="272" y="116" fill="currentColor" style="font-size:1em">o</text><text text-anchor="middle" x="280" y="20" fill="currentColor" style="font-size:1em">o</text><text text-anchor="middle" x="280" y="68" fill="currentColor" style="font-size:1em">c</text><text text-anchor="middle" x="280" y="116" fill="currentColor" style="font-size:1em">m</text><text text-anchor="middle" x="288" y="20" fill="currentColor" style="font-size:1em">r</text><text text-anchor="middle" x="288" y="68" fill="currentColor" style="font-size:1em">r</text><text text-anchor="middle" x="288" y="116" fill="currentColor" style="font-size:1em">e</text><text text-anchor="middle" x="296" y="20" fill="currentColor" style="font-size:1em">t</text><text text-anchor="middle" x="296" y="68" fill="currentColor" style="font-size:1em">a</text><text text-anchor="middle" x="296" y="116" fill="currentColor" style="font-size:1em">t</text><text text-anchor="middle" x="304" y="20" fill="currentColor" style="font-size:1em">e</text><text text-anchor="middle" x="304" y="68" fill="currentColor" style="font-size:1em">p</text><text text-anchor="middle" x="304" y="116" fill="currentColor" style="font-size:1em">h</text><text text-anchor="middle" x="312" y="20" fill="currentColor" style="font-size:1em">r</text><text text-anchor="middle" x="312" y="68" fill="currentColor" style="font-size:1em">e</text><text text-anchor="middle" x="312" y="116" fill="currentColor" style="font-size:1em">e</text><text text-anchor="middle" x="320" y="116" fill="currentColor" style="font-size:1em">u</text><text text-anchor="middle" x="328" y="116" fill="currentColor" style="font-size:1em">s</text><text text-anchor="middle" x="376" y="100" fill="currentColor" style="font-size:1em">d</text><text text-anchor="middle" x="384" y="100" fill="currentColor" style="font-size:1em">a</text><text text-anchor="middle" x="392" y="100" fill="currentColor" style="font-size:1em">t</text><text text-anchor="middle" x="400" y="100" fill="currentColor" style="font-size:1em">a</text><text text-anchor="middle" x="408" y="100" fill="currentColor" style="font-size:1em">s</text><text text-anchor="middle" x="416" y="100" fill="currentColor" style="font-size:1em">o</text><text text-anchor="middle" x="424" y="100" fill="currentColor" style="font-size:1em">u</text><text text-anchor="middle" x="432" y="100" fill="currentColor" style="font-size:1em">r</text><text text-anchor="middle" x="440" y="100" fill="currentColor" style="font-size:1em">c</text><text text-anchor="middle" x="448" y="100" fill="currentColor" style="font-size:1em">e</text><text text-anchor="middle" x="496" y="116" fill="currentColor" style="font-size:1em">G</text><text text-anchor="middle" x="504" y="116" fill="currentColor" style="font-size:1em">r</text><text text-anchor="middle" x="512" y="116" fill="currentColor" style="font-size:1em">a</text><text text-anchor="middle" x="520" y="116" fill="currentColor" style="font-size:1em">f</text><text text-anchor="middle" x="528" y="116" fill="currentColor" style="font-size:1em">a</text><text text-anchor="middle" x="536" y="116" fill="currentColor" style="font-size:1em">n</text><text text-anchor="middle" x="544" y="116" fill="currentColor" style="font-size:1em">a</text></g></svg></div><h2 id=introdution>Introdution</h2><p>This post will be focused on how to customize the snmp_exporter config for pfSense.</p><h2 id=prerequisites>Prerequisites</h2><p>Before we start, it&rsquo;s important to make sure some things has been done.</p><ol><li><p>Enable <code>SNMP</code> service with modules on your pfSense host.</p><ul><li>Enabled modules:<ul><li>MibII</li><li>PF</li><li>Host Resources</li><li>UCD</li></ul></li></ul></li><li><p>Test if you could get metric through <code>snmpwalk</code> command. If not, check if there&rsquo;s any rule block <code>UDP/161</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 192.168.11.1 in this case is our pfSense host.</span>
</span></span><span style=display:flex><span>snmpwalk -v2c -c public 192.168.11.1 1.3.6.1.2.1.1.1.0
</span></span><span style=display:flex><span><span style=color:#75715e># It should return like: iso.3.6.1.2.1.1.1.0 = STRING: &#34;pfSense pfsense.willyhu.local 2.7.2-RELEASE FreeBSD 14.0-CURRENT amd64&#34;</span>
</span></span></code></pre></div></li><li><p>Download <code>BEGEMOT-PF-MIB</code> and its imported modules. You might need to enable ssh login on your pfSense host <em><strong>temporarily</strong></em>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/Downloads/pfmibs
</span></span><span style=display:flex><span>scp admin@192.168.11.1:/usr/share/snmp/mibs/* ~/Downloads/pfmibs
</span></span></code></pre></div></li><li><p>To build <em>snmp_exporter</em> and its <em>generator</em>. You have to install <code>git</code> and <code>go</code> on your local system.</p></li><li><p>Running <em><strong>Prometheus</strong></em> and <em><strong>Grafana</strong></em> server to collect and display metrics as dashboard.</p></li></ol><h2 id=build-and-run-snmp_>Build and run <em><strong>snmp_exporter</strong></em></h2><ul><li>Clone snmp_exporter from github.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/prometheus/snmp_exporter.git
</span></span></code></pre></div></li><li>Build snmp_exporter and test on your local environment.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd snmp_exporter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># build, it will generate defualt snmp.yml config and snmp_exporter excution binary.</span>
</span></span><span style=display:flex><span>make
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># run with default snmp.yml</span>
</span></span><span style=display:flex><span>./snmp_exporter
</span></span></code></pre></div></li><li>Now visit <code>localhost:9116</code> to check exported metrics from web browser. For example: <code>http://localhost:9116/snmp?target=192.168.11.1&amp;auth=public_v2&amp;module=if_mib</code>. There&rsquo;re 3 parameters you can change as you need.<ul><li><em><strong>target</strong></em>: The target SNMP server, in this case, it&rsquo;s pfSense host (192.168.11.1).</li><li><em><strong>auth</strong></em>: The key name of <code>auths</code> in the snmp.yml.</li><li><em><strong>module</strong></em>: The key name of <code>modules</code> in the snmp.yml.</li></ul></li><li>The module <code>if_mib</code> from default config should works on many devices, if you cannot see metrics be exported. Check if the <code>community</code> is correct in the snmp.yml.</li></ul><h2 id=customize-the-config-by-using-generator>Customize the config by using <em><strong>generator</strong></em></h2><p>The default <code>snmp.yml</code> contains too many unnecessary modules for this case. There&rsquo;s only one <em><strong>if_mib</strong></em> moudle is useful. We need to edit generator.yml and customize our own module to generate more sensible snmp.yml for pfSense.</p><ul><li>Build the generator and download default mibs<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># make generator to download defualt mibs</span>
</span></span><span style=display:flex><span><span style=color:#75715e># you might encounter that some of the mibs cannot be downloaded now, just comment them in the Makefile and do again.</span>
</span></span><span style=display:flex><span>cd generate
</span></span><span style=display:flex><span>make generator mibs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># copy pfsense related mibs to current mibs dirctory.</span>
</span></span><span style=display:flex><span>cp -f ~/Download/pfmibs/* ./mibs
</span></span></code></pre></div></li><li>Backup and edit generator.yml for generating new snmp.yml.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># backup original generator.yml</span>
</span></span><span style=display:flex><span>cp generator.yml generator.yml.bak
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># edit generator config for custom module.</span>
</span></span><span style=display:flex><span>vim generator.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># generate new snmp.yml</span>
</span></span><span style=display:flex><span>./generator generate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># you probably got error message like: &#34;cannot find oid &#39;xxxxx&#39; to walk&#34;.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># that&#39;s because the generator default load mibs from `$HOME/.snmp/mibs` or `/usr/share/snmp/mibs`</span>
</span></span><span style=display:flex><span><span style=color:#75715e># you can either copy all mib files to one of those path</span>
</span></span><span style=display:flex><span><span style=color:#75715e># or run the generator with MIBDIRS variable.</span>
</span></span><span style=display:flex><span>MIBDIRS<span style=color:#f92672>=</span>./mibs ./generator generate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># copy new snmp.yml to parent directory.</span>
</span></span><span style=display:flex><span>cp ./snmp.yml ../snmp-v1.yml 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># run snmp-exporter with new generated config.</span>
</span></span><span style=display:flex><span>cd ..
</span></span><span style=display:flex><span>./snmp_exporter --config.file<span style=color:#f92672>=</span>snmp-v1.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># checking the new custom module on your local environment :)</span>
</span></span><span style=display:flex><span>curl -s <span style=color:#e6db74>&#34;http://localhost:9116/snmp?target=192.168.11.1&amp;auth=public_v2&amp;module=pfsense&#34;</span> | less
</span></span></code></pre></div></li><li>An example <code>generator.yml</code> for monitoring pfSense host.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>auths</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>public_v1</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>public_v2</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>modules</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>pfsense</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>walk</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.2.1.2</span>                 <span style=color:#75715e># MIB2::interfaces</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.2.1.31.1</span>              <span style=color:#75715e># MIB2::ifMIB::ifXTable</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.4.1.2021.4</span>            <span style=color:#75715e># UCD(ucdavis)::memory</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.4.1.2021.9</span>            <span style=color:#75715e># UCD(ucdavis)::disk</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.4.1.2021.10</span>           <span style=color:#75715e># UCD(ucdavis)::loadAverage</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.4.1.2021.11</span>           <span style=color:#75715e># UCD(ucdavis)::cpu</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.4.1.12325.1.200.1.1</span>   <span style=color:#75715e># BEGEMOT-PF-MIB::pfStatus</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.4.1.12325.1.200.1.8</span>   <span style=color:#75715e># BEGEMOT-PF-MIB::pfInterface</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1.3.6.1.4.1.12325.1.200.1.11</span>  <span style=color:#75715e># BEGEMOT-PF-MIB::pfLabels</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lookups</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_indexes</span>: [<span style=color:#ae81ff>ifIndex]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>lookup</span>: <span style=color:#ae81ff>ifAlias</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_indexes</span>: [<span style=color:#ae81ff>ifIndex]</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Use OID to avoid conflict with Netscaler NS-ROOT-MIB.</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>lookup</span>: <span style=color:#ae81ff>1.3.6.1.2.1.31.1.1.1.1</span> <span style=color:#75715e># ifName</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_indexes</span>: [<span style=color:#ae81ff>pfInterfacesIfIndex]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>lookup</span>: <span style=color:#ae81ff>pfInterfacesIfDescr</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_indexes</span>: [<span style=color:#ae81ff>pfLabelsLblIndex]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>lookup</span>: <span style=color:#ae81ff>pfLabelsLblName</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>overrides</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifAlias</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifDescr</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifName</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ifType</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>EnumAsInfo</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>pfInterfacesIfDescr</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>DisplayString</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>pfLabelsLblName</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>DisplayString</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>pfLogInterfaceName</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ignore</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>type</span>: <span style=color:#ae81ff>DisplayString</span>
</span></span></code></pre></div></li></ul><h2 id=prometheus-scrape-config>Prometheus Scrape Config</h2><p>Once we&rsquo;ve got snmp_exporter running. We must config Prometheus to collect those metrics as time series datapoints.</p><p>Refs:</p><ul><li><a href="https://github.com/prometheus/snmp_exporter?tab=readme-ov-file#prometheus-configuration">https://github.com/prometheus/snmp_exporter?tab=readme-ov-file#prometheus-configuration</a></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>    - <span style=color:#f92672>job_name</span>: <span style=color:#ae81ff>pfsense</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>targets</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>192.168.11.1</span> <span style=color:#75715e># pfSense host</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>metrics_path</span>: <span style=color:#ae81ff>/snmp</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>params</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>auth</span>: [<span style=color:#ae81ff>public_v2]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>module</span>: [<span style=color:#ae81ff>pfsense]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>relabel_configs</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__address__]</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>__param_target</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__param_target]</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>instance</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>__address__</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>replacement</span>: <span style=color:#ae81ff>prometheus-snmp-exporter:9116</span> <span style=color:#75715e># snmp_exporter server</span>
</span></span></code></pre></div><h2 id=grafana-dashboard>Grafana Dashboard</h2><p>This is an example dashboard that consist of pfSense SNMP metrics in Prometheus. You can <a href=/files/pfsense-states-20240423-2135.json>download</a> and import into your own Grafana server.</p><p><img src=/images/pfsense-states-grafana.png alt="The Grafana dashboard of pfSense states."></p></div><div class=prev-next></div></div></main><footer class=footer><span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>